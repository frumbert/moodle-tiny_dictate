define("tiny_dictate/commands",["exports","editor_tiny/utils","core/str","./common"],(function(_exports,_utils,_str,_common){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0;
/**
   * Recognise the speech and insert it into the editor.
   *
   * @module     tiny_dictate/commands
   * @copyright
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   *
   */
const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition,recognition=SpeechRecognition?new SpeechRecognition:null;let recognizing=!1;recognition&&(recognition.continuous=!0,recognition.interimResults=!0,recognition.lang=navigator.language);_exports.getSetup=async()=>{const[buttonTooltip,buttonImage]=await Promise.all([(0,_str.get_string)("button_toggle_dictate",_common.component),(0,_utils.getButtonImage)("icon",_common.component)]),SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;return editor=>{SpeechRecognition&&(editor.ui.registry.addIcon(_common.icon,buttonImage.html),editor.ui.registry.addToggleButton(_common.dictateButtonName,{icon:_common.icon,tooltip:buttonTooltip,onAction:buttonApi=>((editor,buttonApi)=>{recognition&&(recognizing=!recognizing,recognizing?(recognition.start(),buttonApi.setActive(!0)):recognition.stop(),recognition.onresult=event=>{let final_transcript="";for(let i=event.resultIndex;i<event.results.length;++i)event.results[i].isFinal&&(final_transcript+=event.results[i][0].transcript);final_transcript&&editor.insertContent(final_transcript)},recognition.onerror=event=>{window.console.log(event)},recognition.onend=()=>{recognizing?recognition.start():buttonApi.setActive(!1)})})(editor,buttonApi),onSetup:buttonApi=>(recognition&&recognition.addEventListener("end",(()=>{buttonApi.setActive(!1)})),()=>{})}))}}}));

//# sourceMappingURL=commands.min.js.map